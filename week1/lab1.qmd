---
title: "Lab 1"
subtitle: "Exploratory data analysis"
toc: true
editor: visual
format:
  html:
    other-links:
      - text: Download Source
        href: lab1.qmd
---

## Learning objectives

In today's lab you will...

1.  Numerically and graphically explore **categorical** data
2.  Numerically and graphically explore **continuous** data
3.  Explore a real world dataset

## Setup

```{r}
library(tidyverse)
library(palmerpenguins)
theme_set(theme_bw(18))

```

We'll use the `penguins` dataset for today's lab. Refresh your memory of what it looks like with `glimpse()`.

```{r}
glimpse(penguins)

```

## Categorical data

Categorical data fall into discrete categories. Examples include:

-   Land cover type (e.g., forest, wetland, urban)

-   Energy source (e.g., solar, wind, natural gas, coal)

-   Air pollutant (e.g., common, hazardous, particulate matter)

We usually summarize categorical data using counts and proportions. Here we'll explore how to do so with tables and figures.

### Contingency tables

Contingency tables summarize *combinations* of variables by frequency. Create one using the base R function `table()`. The table below reveals an important pattern not apparent using `glimpse()`: not all species of penguins were observed at all islands.

```{r}
table(penguins$species, penguins$island)

```

The tidyverse `count()` function will give you a contingency table in long format.

```{r}
table <- penguins %>% 
  count(species, island)

```

**Q1** How would you pivot it to look like the contingency table above?

```{r}
penguins %>% 
  count(species, island) %>% 
  pivot_wider(names_from = species, 
              values_from = n, 
              values_fill = 0)

table %>% 
    pivot_wider(names_from = species, 
              values_from = n, 
              values_fill = 0)

```

![]()

```{r}
#| label: q1

penguins %>% 
  count(species, island) %>% 
  pivot_wider(names_from = island, 
              values_from = n, 
              values_fill = 0)

```

We often modify contingency tables in two ways.

First, we often add *marginal* totals, i.e., the total of each row and column. The `addmargins()` function does that for us.

```{r}
species_island_table <- table(penguins$species, penguins$island)
addmargins(species_island_table)

```

These marginal totals demonstrate how counts can be difficult to compare, if they come from rows or columns with different totals. For example, more AdÃ©lie penguins were observed at Dream than Torgersen, but they represent a smaller fraction of the observations. Normalizing by *proportion* helps clarify that. You can calculate proportions either by row or column, for which we can use `prop.table()`.

```{r}
# Row proportions
prop.table(species_island_table, margin = 1)
# Column proportions
prop.table(species_island_table, margin = 2)

```

**Q2** How would you use `count()`, `group_by()`, `mutate()`, and pivoting to create row- and column-wise proportion tables?

```{r}
penguins %>% 
  count(species, island)
```

```{r}
# *** I DONT UNDERSTAND THE DIFFERENCE BETWEEN THESE *** 

# Finding column proportions
col_prop <- penguins %>% 
  count(species, island) %>% 
  group_by(island) %>%   # per column 
  mutate(prop = n/sum(n))

print(col_prop)

# Finding row proportions 
row_prop <- penguins %>% 
  count(species, island) %>% 
  group_by(species) %>%   # per row 
  mutate(prop = n/sum(n))

print(row_prop)
```

![]()

### Bar plots

Bar plots are effective for visualizing counts and proportions of one or more categories.

This bar plot visualizes the counts of each species.

```{r}
ggplot(penguins, aes(species)) +
  geom_bar()

```

**Q3 How would you use another aesthetic to show the composition of each species by island?**

```{r}
#| label: q3

ggplot(penguins, aes(species, fill = island)) +
  geom_bar()

```

**Q4** **Contrast the bar plot from Q3 with the contingency table from the beginning of the lab - how do they convey information differently?**

## Continuous data

Continuous data can take any value within their bounds. Examples include:

-   Unbounded data (e.g., temperature[^1])

-   Bounded on one side (e.g., time-to-failure can only be positive)

-   Bounded on two sides (e.g., fractional cover of an invasive plant in a quadrat)

[^1]: Yes, absolute zero does exist, but practically for our purposes temperature is unbounded

We can graphically depict continuous data as one variable (i.e., its distribution) or the relationship between two variables.

### Histograms and shape

Histograms show the frequency of observations within bins, revealing the shape of the variable's distribution.

```{r}
penguins %>% 
  ggplot(aes(body_mass_g)) +
  geom_histogram()

```

**Q5 What's the difference between a histogram and a bar plot?**

Histogram - 1 continuous variable, showing its frequency on the y! Binning data

Bar plot - Categorical data

### Mean and standard deviation

Recall that parameters and statistics are numerical summaries of populations and samples, respectively. Mean and standard deviation are useful summaries, but be careful as they can hide important differences.

The mean is a measure of *central tendency* i.e., the expected or center value of an observation in the sample. The standard deviation is a measure of *variation* i.e., how spread out the sample is.

As a rule of thumb, about 68% of a sample's data will fall within one standard deviation of the mean, and about 95% will fall within two standard deviations. The more "normally" distributed the data is (more on that tomorrow) the better these rules of thumb hold. Highly skewed data or data with a lot of outliers will deviate more from the rule of thumb.

**Q6 What percentage of penguin body masses fall within one standard deviation of the mean? Within two?**

```{r}
#| label: q6
body_mass <- penguins$body_mass_g[!is.na(penguins$body_mass_g)]
sd_mass <- sd(penguins$body_mass_g, na.rm = TRUE)
mean_mass <- mean(penguins$body_mass_g, na.rm = TRUE)

#how many penguins have a body mass between 1 and 2 stand devisition from the mean 
win1sd <- mean(body_mass >= mean_mass - sd_mass & body_mass <= mean_mass + sd_mass)


win2sd <- mean(body_mass >= mean_mass - 2*sd_mass & body_mass <= mean_mass + 2*sd_mass)

```

### Scatterplots for paired data

Scatter plots depict relationships between variables.

```{r}
penguins %>% 
  ggplot(aes(bill_length_mm, bill_depth_mm)) +
  geom_point()+ 
  geom_smooth(method = line)

```

The scatterplot above suggests little relationship between bill length and depth, or perhaps a slightly negative correlation. That means longer bills are not associated with deeper bills. However, if you ask a penguin anatomist, they'll tell you the opposite is true: longer bills tend to be deeper, too. How can we reconcile these contrasting statements?

This is an example of *Simpson's paradox*, which is when between-group correlations of one kind mask within-group correlations of another kind. Unmask the paradox by color-coding the points by species.

**Q7: Modify the scatterplot above to color-code the points by species. Then describe the correlations between bill depth, bill length, and species. How do the correlations across species mask the correlations within?**

```{r}
#| label: q7
penguins %>% 
  ggplot(aes(bill_length_mm, bill_depth_mm, color = species)) +
  geom_point() + 
  geom_smooth()

```

\

## Where to find data

The Yale University Library provides a [useful guide](https://guides.library.yale.edu/c.php?g=296375&p=7352744) for where to find environmental data. The categories include:

-   General Environmental Data

-   Energy Data

-   Climate & Atmospheric Data

-   Agricultural, Forestry, and Ecology Data

-   Health Related Data

Find a dataset containing multiple categorical and continuous variables. You'll have an easier time if you limit your search to tabular data. Explore the data using each of the following tools.

1.  Contingency table
2.  Bar plot
3.  Histogram
4.  Scatterplot

## Finished?

If you wrap up before lab is over, head over to the final project page on the course website and look at the section [Model and response options](https://eds-222-stats-f25.github.io/final-project.html#model-and-response-options). Your final project will require you to choose a question and data to investigate using a model *we won't teach you in class*. The defining characteristic for these models are the **response variable** they can handle. Start thinking up a question and looking for data where the response variable has characteristics listed in the [Model and response options](https://eds-222-stats-f25.github.io/final-project.html#model-and-response-options) table. Keep in mind that transformations and merging datasets are both options, so even if the raw data you find don't match one of the eligible models, you may be able to derive something that does. Happy hunting!

![]()

```{r}
# Load data
temp_df <- read_csv(here::here("week1", "global_temp.csv"))

diet_df <- read_csv(here::here("week1", "dietary-choices-uk.csv"))
```

```{r}
# Filter Data

sub_diet <- diet_df[, c(1, 9)]

mean_diet <- sub_diet %>% 
  group_by(Entity) %>% 
  summarise(mean_veg = mean(`Percentage of vegetarians`, na.rm= TRUE))

mean_diet <- mean_diet %>% 
  filter(!Entity == "All adults")

class(mean_diet)
```

```{r}
# Make a graph 
library(ggplot2)

ggplot(mean_diet, 
       aes(x=Entity, 
           y=mean_veg)) + 
  geom_col(fill = '#488f30')+ 
  labs(title = 'Avg Percentages of Vegetarians Across Age Groups', 
       x = 'Age Brackets', 
       y = 'Average Percentages of Vegetarians')

ggsave(here::here('week1', 'VegGraph.png'), height = 8, width = 8)

```

c('Percentage of flexitarians', 'Percentage of people with other diets', 'Percentage of vegans', 'Percentage of meat eaters','Percentage of pescetarians', 'Percentage of vegetarians')

```{r}
# makeing a new column with just the year 
# averaging info from the same year 
# deleting unnessacry columns 
diet_df_year <- diet_df %>% 
  mutate(year = year(diet_df$Day)) %>% 
  group_by(year) %>% 
  summarise(across(everything(), mean, na.rm = TRUE)) %>% 
  select(!c(Entity, Code, Day))

print(diet_df_year)


# transposing dataframe 
# changing column nameto the years
diet_t <- t(diet_df_year)
colnames(diet_t) <- c('2019', '2020', '2021', '2022', '2023','2024', '2025') 
                            
diet_t <- as.data.frame(diet_t[-c(1), ]) #deleting the row of years
print(diet_t)



# attempting to pivot and rotate the df 
diet_long <- pivot_longer(diet_df_year, 
             cols = starts_with("Percentage"), 
             names_to = 'Diets', 
             values_to = 'Percentages'
             )

pivot_wider(diet_df_year,
            names_from = 'year', 
            values_from = starts_with("Percentage"))
            )

diet_t %>%
  pivot_longer(
    cols = everything(), # Selects all columns to pivot
    names_to = "Variable", # New column to store original column names
    values_to = "Value" # New column to store the values from the pivoted columns
  ) 
  

# graphing 
ggplot(diet_df_year, 
       aes(x = year, fill = )) + 
  geom_bar()

ggplot(diet_t, 
       aes(x = colnames(), fill = )) + 
  geom_bar()

ggplot(diet_long,
       aes(x = 'year', 
           y = 'Percentages', 
           fill = 'Diet')) + 
  geom_col()

ggplot(data, aes(fill=condition, y=value, x=specie)) + 
    geom_bar(position="stack", stat="identity")

ggplot(diet_t, 
       x = )

# geom_bar(position = "fill")

diet_long

```
